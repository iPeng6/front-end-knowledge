# SQL 注入

<details>
<summary>引用参考 - 2020/05/19</summary>

- [sql 注入](https://baike.baidu.com/item/sql%E6%B3%A8%E5%85%A5) _- 百度百科_
- [sql 注入](https://baike.so.com/doc/6793375-7010077.html) _- 360 百科_

</details>

在当今技术背景下，大部分网站对于用户交互显示的内容，都是存储在数据库当中，网站的每个功能均会获取用户主动或者被动输入的关键数据，而网站的后端已经封装好了一个完整的 SQL 语句，只需要将用户输入的关键数据放入 SQL 语句的固定查询点内，SQL 查询之后就会返回给用户一个想用的内容，通过用户的浏览器呈现为一个可交互的网页，在这个过程中，如果用户输入的关键数据是一个 SQL 语句片段，当这个片段传入后端，放入固定的 SQL 语句的查询点后，会破坏 SQL 语句原有的查询方法，当用户输入的 SQL 语言片段是恶意的，完全可以使原有的 SQL 语句功能失效，而实际执行内容被控制的结果，恶意用户就可以不断的变化输入的 SQL 片段，从数据库中返回不应该被查询到的数据返回到浏览器的前端。

根据输入类型的不同，可将 SQL 注入方式大致分为两类：数字型注入、字符型注入。

## 数字型注入

当输入的参数为整型时，如 ID、年龄、页码等，如果存在注入漏洞，则可以认为是数字型注入。这种数字型注入最多出现在 ASP、PHP 等弱类型语言中，弱类型语言会自动推导变量类型，例如，参数 id=8，PHP 会自动推导变量 id 的数据类型为 int 类型，那么 id=8 and 1=1，则会推导为 string 类型，这是弱类型语言的特性。而对于 Java、C#这类强类型语言，如果试图把一个字符串转换为 int 类型，则会抛出异常，无法继续执行。所以，强类型的语言很少存在数字型注入漏洞。

比如，这样一段 SQL

```sql
SELECT * FROM USERS WHERE ID=1
```

输入 `1 AND 1=1`，结果

```sql
SELECT * FROM USERS WHERE ID=1 AND 1=1
```

这样就相当于查出了所有结果

## 字符型注入

当输入参数为字符串时，称为字符型。数字型与字符型注入最大的区别在于：数字型不需要单引号闭合，而字符串类型一般要使用单引号来闭合。

比如，这样一段 SQL，TEST 为用户输入内容

```sql
SELECT * FROM USERS WHERE NAME='TEST'
```

那么可以输入 `TEST' AND '1'='1`，得到

```sql
SELECT * FROM USERS WHERE NAME='TEST' AND '1'='1'
```

## 防范

1. 输入验证
2. 参数化查询，避免直接 SQL 拼接
