# ES2018

## Rest/Spread Properties

ES6 åœ¨å¤„ç†æ•°ç»„è§£æ„æ—¶,å¼•å…¥äº† rest(å‰©ä½™)å…ƒç´ çš„æ¦‚å¿µï¼Œä¾‹å¦‚ï¼š

```js
const numbers = [1, 2, 3, 4, 5]
[first, second, ...others] = numbers
```

è¿˜æœ‰å±•å¼€å…ƒç´ æ—¶ï¼š

```js
const numbers = [1, 2, 3, 4, 5]
const sum = (a, b, c, d, e) => a + b + c + d + e
const sum = sum(...numbers)
```

ES2018 ä¸ºå¯¹è±¡å¼•å…¥äº†ç±»ä¼¼çš„åŠŸèƒ½ã€‚

```js
const { first, second, ...others } = {
  first: 1,
  second: 2,
  third: 3,
  fourth: 4,
  fifth: 5
}
first // 1
second // 2
others // { third: 3, fourth: 4, fifth: 5 }

const items = { first, second, ...others }
items //{ first: 1, second: 2, third: 3, fourth: 4, fifth: 5 }
```

## Asynchronous iteration

æ–°çš„ `for-await-of` æ„é€ å…è®¸æ‚¨ä½¿ç”¨å¼‚æ­¥å¯è¿­ä»£å¯¹è±¡ä½œä¸ºå¾ªç¯è¿­ä»£ï¼š

```js
for await (const line of readLines(filePath)) {
  console.log(line)
}
```

ç”±äºè¿™ä½¿ç”¨ await ï¼Œä½ åªèƒ½åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨å®ƒï¼Œå°±åƒæ™®é€šçš„ await ä¸€æ ·

## Promise.prototype.finally()

å½“ Promise å®Œæˆï¼ŒæˆåŠŸä¹‹åä¼šä¸€ä¸ªæ¥ç€ä¸€ä¸ªè°ƒç”¨ `then()`ï¼Œå¦‚æœå¤±è´¥åˆ™è·³è¿‡`then()`ï¼Œæ‰§è¡Œ`catch()`.

`finally()` å…è®¸ä½ æ— è®ºæˆåŠŸè¿˜æ˜¯å¤±è´¥éƒ½å¯ä»¥è¿è¡Œä¸€æ®µä»£ç 

```js
fetch('file.json')
  .then(data => data.json())
  .catch(error => console.error(error))
  .finally(() => console.log('finished'))
```

## Regular Expression improvements

### Lookbehinds

æ­£åˆ™è¡¨è¾¾å¼æ”¹è¿›ï¼Œå¢åŠ äº†åè¡Œæ–­è¨€(lookbehinds)ï¼šæ ¹æ®å‰é¢çš„å†…å®¹åŒ¹é…å­—ç¬¦ä¸²ã€‚

å…ˆæ¥çœ‹ä¸‹å…ˆè¡Œæ–­è¨€(lookahead)ï¼šæ‚¨å¯ä»¥ä½¿ç”¨ `?=` åŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åé¢è·Ÿç€ä¸€ä¸ªç‰¹å®šçš„å­å­—ç¬¦ä¸²ï¼š

```js
/Roger (?=Waters)/
/Roger (?=Waters)/.test('Roger is my dog') //false
/Roger (?=Waters)/.test('Roger Waters is a famous musician') //true
```

`?!` æ‰§è¡Œé€†æ“ä½œï¼ŒåŒ¹é…ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²åé¢æ²¡æœ‰ä¸€ä¸ªç‰¹å®šçš„å­å­—ç¬¦ä¸²ï¼š

```js
/Roger (?!Waters)/
/Roger (?!Waters)/.test('Roger is my dog') //true
/Roger (?!Waters)/.test('Roger Waters is a famous musician') //false
```

å…ˆè¡Œæ–­è¨€(lookahead)ä½¿ç”¨ `?=` ç¬¦å·ã€‚å®ƒä»¬å·²ç»å¯ç”¨äº†ã€‚

åè¡Œæ–­è¨€(lookbehinds)ï¼Œæ˜¯ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œä½¿ç”¨ `?<=`

```js
/(?<=Roger) Waters/
/(?<=Roger) Waters/.test('Pink Waters is my dog') //false
/(?<=Roger) Waters/.test('Roger Waters is a famous musician') //true
```

åè¡Œæ–­è¨€(lookbehind) é€†æ“ä½œï¼Œä½¿ç”¨ `?<!`

```js
/(?<!Roger) Waters/
/(?<!Roger) Waters/.test('Pink Waters is my dog') //true
/(?<!Roger) Waters/.test('Roger Waters is a famous musician') //false
```

ä¸ç®¡æ˜¯å…ˆè¡Œæ–­è¨€è¿˜æ˜¯åè¡Œæ–­è¨€ï¼ŒåŒ¹é…å†…å®¹éƒ½ä¸åŒ…æ‹¬æ–­è¨€æœ¬èº«

```js
'Roger Waters is a famous musician'.match(/Roger (?=Waters)/)[0] // Roger
'Roger Waters is a famous musician'.match(/(?<=Roger) Waters/)[0] // Waters
```

### Unicode property escapes \p{â€¦} and \P{â€¦}

åœ¨æ­£åˆ™è¡¨è¾¾å¼æ¨¡å¼ä¸­ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨ `\d` åŒ¹é…ä»»ä½•æ•°å­—ï¼Œ`\s` åŒ¹é…ä»»ä½•ç©ºç™½å­—ç¬¦ï¼Œ`\w` åŒ¹é…ä»»ä½•å­—æ¯æ•°å­—å­—ç¬¦ï¼Œä¾æ­¤ç±»æ¨ã€‚

è¿™ä¸ªæ–°åŠŸèƒ½å°†æ‰©å±•æ­¤æ¦‚å¿µå¼•å…¥ `\p{}` åŒ¹é…æ‰€æœ‰ Unicode å­—ç¬¦ï¼Œå¦å®šå½¢å¼ä¸ºå¤§å†™çš„ `\P{}` ã€‚

ä»»ä½• Unicode å­—ç¬¦éƒ½æœ‰ä¸€ç»„å±æ€§ã€‚ ä¾‹å¦‚ï¼Œ`Script` ç¡®å®šè¯­è¨€ç³»åˆ—ï¼Œ`ASCII` æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œ å¯¹äº `ASCII` å­—ç¬¦ï¼Œå€¼ä¸º trueï¼Œä¾æ­¤ç±»æ¨ã€‚ æ‚¨å¯ä»¥å°†æ­¤å±æ€§æ”¾åœ¨èŠ±æ‹¬å·ä¸­ï¼Œæ­£åˆ™è¡¨è¾¾å¼å°†æ£€æŸ¥æ˜¯å¦ä¸ºçœŸï¼š

```js
/^\p{ASCII}+$/u.test('abc')   //âœ…
/^\p{ASCII}+$/u.test('ABC@')  //âœ…
/^\p{ASCII}+$/u.test('ABCğŸ™ƒ') //âŒ
```

`ASCII_Hex_Digit` æ˜¯å¦ä¸€ä¸ªå¸ƒå°”å±æ€§ï¼Œç”¨äºæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ä»…åŒ…å«æœ‰æ•ˆçš„åå…­è¿›åˆ¶æ•°å­—ï¼š

```js
/^\p{ASCII_Hex_Digit}+$/u.test('0123456789ABCDEF') //âœ…
/^\p{ASCII_Hex_Digit}+$/u.test('h')                //âŒ
```

è¿˜æœ‰è®¸å¤šå…¶ä»–å¸ƒå°”å±æ€§ï¼Œæ‚¨åªéœ€é€šè¿‡åœ¨èŠ±æ‹¬å·ä¸­æ·»åŠ å®ƒä»¬çš„åç§°æ¥æ£€æŸ¥å®ƒä»¬ï¼ŒåŒ…æ‹¬ `Uppercase`, `Lowercase`, `White_Space`, `Alphabetic`, `Emoji` ç­‰ï¼š

```js
/^\p{Lowercase}$/u.test('h') //âœ…
/^\p{Uppercase}$/u.test('H') //âœ…
/^\p{Emoji}+$/u.test('H')   //âŒ
/^\p{Emoji}+$/u.test('ğŸ™ƒğŸ™ƒ') //âœ…
```

é™¤äº†è¿™äº›äºŒè¿›åˆ¶å±æ€§ä¹‹å¤–ï¼Œæ‚¨è¿˜å¯ä»¥æ£€æŸ¥ä»»ä½• unicode å­—ç¬¦å±æ€§ä»¥åŒ¹é…ç‰¹å®šå€¼ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘æ£€æŸ¥å­—ç¬¦ä¸²æ˜¯ç”¨å¸Œè…Šè¯­è¿˜æ˜¯æ‹‰ä¸å­—æ¯å†™çš„

```js
/^\p{Script=Greek}+$/u.test('ÎµÎ»Î»Î·Î½Î¹ÎºÎ¬') //âœ…
/^\p{Script=Latin}+$/u.test('hey') //âœ…
```

### Named capturing groups

åœ¨ ES2018 ä¸­ï¼Œæ­£åˆ™åŒ¹é…å¯ä»¥ä¸ºæ•è·ç»„èµ·ä¸ªåç§°

```js
const re = /(?<year>\d{4})-(?<month>\d{2})-(?<day>\d{2})/
const result = re.exec('2015-01-02')
// result.groups.year === '2015';
// result.groups.month === '01';
// result.groups.day === '02';
```

### The 'sâ€™ flag for regular expressions

`s` æ ‡å¿— single line çš„ç¼©å†™ï¼Œå®ƒä½¿å¾— `.` å¯ä»¥åŒ¹é…æ¢è¡Œ `\r \n`

```js
/hi.welcome/.test('hi\nwelcome') // false
/hi.welcome/s.test('hi\nwelcome') // true
```
